<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!--This is the addenda-->
    <template id="gs1" name="GS1">
        <t t-set="values" t-value="record.x_l10n_cr_edi_addenda.split('|') if record.x_l10n_cr_edi_addenda else False"/>
        <t t-if="record.move_type in ['out_invoice', 'out_refund']">
            <compra_entrega>
                <t t-if="values and len(values) >= 1">
                    <numerovendedor t-raw="values[0]"/>
                </t>
                <t t-if="values and len(values) >= 2">
                    <numeroorden t-raw="values[1]"/>
                </t>
                <t t-if="values and len(values) >= 3">
                    <enviargln t-raw="values[2]"/>
                </t>
                <t t-if="values and len(values) >= 4">
                    <fechaorden t-raw="values[3]"/>
                </t>
                <t t-if="values and len(values) >= 5">
                    <numerorecepcion t-raw="values[4]"/>
                </t>
            </compra_entrega>
        </t>
    </template>

    <record id="gs1" model="ir.ui.view">
        <field name="l10n_cr_edi_addenda_flag">True</field>
    </record>

    <!--Wizard to set elements-->
    <record id="l10n_cr_edi_wizard_addenda" model="ir.model">
        <field name="name">Addenda</field>
        <field name="transient" eval="True"/>
        <field name="model">x_addenda.l10n_cr_edi</field>
        <field name="info">Addend documentation</field>
    </record>

    <!--Fields on the wizard-->
    <record id="l10n_cr_edi_wizard_addenda_vendor_number" model="ir.model.fields">
        <field name="name">x_vendor_number</field>
        <field name="field_description">Vendor Number</field>
        <field name="ttype">char</field>
        <field name="size">50</field>
        <field name="help">Alphanumeric provider code. Up to 50 digits.</field>
        <field name="model_id" ref="l10n_cr_edi_wizard_addenda"/>
    </record>
    <record id="l10n_cr_edi_wizard_addenda_order_number" model="ir.model.fields">
        <field name="name">x_order_number</field>
        <field name="field_description">Order Number</field>
        <field name="ttype">char</field>
        <field name="size">50</field>
        <field name="help">Alphanumeric Purchase order. Up to 50 digits</field>
        <field name="model_id" ref="l10n_cr_edi_wizard_addenda"/>
    </record>
    <record id="l10n_cr_edi_wizard_addenda_gln" model="ir.model.fields">
        <field name="name">x_gln</field>
        <field name="field_description">Global Location Number (GLN)</field>
        <field name="ttype">char</field>
        <field name="size">13</field>
        <field name="help">GLN stands for Global Location Number. Up to 13 digits</field>
        <field name="model_id" ref="l10n_cr_edi_wizard_addenda"/>
    </record>
    <record id="l10n_cr_edi_wizard_addenda_order_date" model="ir.model.fields">
        <field name="name">x_order_date</field>
        <field name="field_description">Order Date</field>
        <field name="ttype">date</field>
        <field name="help">Purchase order date in YYYYMMDD format.</field>
        <field name="model_id" ref="l10n_cr_edi_wizard_addenda"/>
    </record>
    <record id="l10n_cr_edi_wizard_addenda_receipt_number" model="ir.model.fields">
        <field name="name">x_receipt_number</field>
        <field name="field_description">Receipt Document Number</field>
        <field name="ttype">char</field>
        <field name="size">50</field>
        <field name="help">Alphanumeric Purchase order. Up to 50 digits</field>
        <field name="model_id" ref="l10n_cr_edi_wizard_addenda"/>
    </record>
    <record id="l10n_cr_edi_wizard_addenda_claim_number" model="ir.model.fields">
        <field name="name">x_claim_number</field>
        <field name="field_description">Claim Number</field>
        <field name="ttype">char</field>
        <field name="size">10</field>
        <field name="help">Alphanumeric Clame Number. Up to 10 digits</field>
        <field name="model_id" ref="l10n_cr_edi_wizard_addenda"/>
    </record>

    <!--Fields in invoice-->
    <record id="invoice_l10n_cr_edi_field" model="ir.model.fields">
        <field name="name">x_l10n_cr_edi_addenda</field>
        <field name="field_description">Addenda</field>
        <field name="ttype">char</field>
        <field name="copied" eval="False"/>
        <field name="help">Used to concatenate fields x_vendor_number, x_order_number, x_gln, x_order_date, x_receipt_number and x_claim_number</field>
        <field name="model_id" model="ir.model" search="[('model', '=', 'account.move')]"/>
    </record>

    <!--Server action that will set the values on the invoice.-->
    <record id="set_l10n_cr_edi_addenda_values" model="ir.actions.server">
        <field name="name">Set Values Addenda</field>
        <field name="model_id" ref="account.model_account_move"/>
        <field name="state">code</field>
        <field name="code">
invoice = env['account.move'].browse(model._context['invoice_id'])
wizard = env['x_addenda.l10n_cr_edi'].browse(model._context['active_id'])
wizard_fields = [wizard.x_vendor_number, wizard.x_order_number, wizard.x_gln, str(wizard.x_order_date), wizard.x_receipt_number, wizard.x_claim_number]
wizard_fields = [j or '' for j in wizard_fields]
invoice.write({'x_l10n_cr_edi_addenda': '|'.join(wizard_fields)})
        </field>
    </record>

</odoo>
